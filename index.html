<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>EHT Attack Speed + DPS Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="EHT Calc">
  <style>
    body { font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 1.25rem auto; padding: 0 14px; }
    h1 { font-size: 1.4rem; margin-bottom: .5rem; }
    h2 { font-size: 1.15rem; margin-top: 1.25rem; }
    .grid { display: grid; grid-template-columns: 220px 1fr; gap: 10px; align-items: center; }
    .card { border: 1px solid #e5e5e5; border-radius: 12px; padding: 14px; margin: 12px 0; box-shadow: 0 1px 0 rgba(0,0,0,.03); }
    .row { display: contents; }
    input[type="number"], input[readonly], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; }
    input[readonly] { background:#f9fafb; font-weight:700; }
    .muted { color: #666; font-size: .9rem; }
    .inline { display:flex; align-items:center; gap:10px; }
    .disabled { opacity:0.5; pointer-events:none; }
    .pct { position:relative; display:flex; align-items:center; }
    .pct input { width:100%; padding-right:32px; }
    .pct .suffix { position:absolute; right:10px; color:#666; pointer-events:none; }
    .bar { height: 14px; background: #f0f0f0; border-radius: 999px; overflow: hidden; margin-top:8px; }
    .bar > div { height: 100%; width: 0%; transition: width .25s ease, background .25s ease; }
    .boxrow { display:grid; grid-template-columns: 220px 1fr; gap:10px; align-items:center; margin-top:10px; }
  </style>
</head>
<body>
  <h1>EHT Attack Speed + DPS Calculator</h1>

  <div class="card">
    <h2>Base & Buffs</h2>
    <div class="grid">
      <div class="row">
        <label>Class</label>
        <select id="cls">
          <option>Berserker</option>
          <option>Paladin</option>
          <option>Ranger</option>
          <option selected>Sorcerer</option>
        </select>
      </div>
      <div class="row">
        <label>Weapon Speed</label>
        <select id="weap">
          <option>Original</option>
          <option>Primal</option>
          <option selected>PVP/Boss</option>
        </select>
      </div>
      <div class="row">
        <label>Characteristic</label>
        <select id="char">
          <option value="0">None</option>
          <option value="7" selected>Heroic (+7%)</option>
          <option value="10">Swift (+10%)</option>
        </select>
      </div>
      <div class="row">
        <label>Atk SPD Colour</label>
        <select id="col">
          <option value="0">Normal (+0%)</option>
          <option value="10">Blue (+10%)</option>
          <option value="20">Orange (+20%)</option>
          <option value="30" selected>Purple (+30%)</option>
        </select>
      </div>
      <div class="row">
        <label>Guild Buff</label>
        <div class="pct"><input id="guild" type="number" step="0.1" value="5"><span class="suffix">%</span></div>
      </div>
      <div class="row">
        <label>Secret Tech</label>
        <div class="pct"><input id="secret" type="number" step="0.1" value="10"><span class="suffix">%</span></div>
      </div>
      <div class="row">
        <label>Equipment ATK SPD</label>
        <div class="pct"><input id="equip" type="number" step="0.1" value="0"><span class="suffix">%</span></div>
      </div>
      <div class="row">
        <label>Rune ATK SPD</label>
        <div class="pct"><input id="rune" type="number" step="0.1" value="0"><span class="suffix">%</span></div>
      </div>
      <!-- Hidden target final ATK SPD -->
      <div class="row hidden">
        <label>Target Final ATK SPD</label>
        <input id="target" type="number" step="0.01" value="0.25">
      </div>
      <div class="row">
        <label>Quicken</label>
        <div class="pct"><input id="quicken" type="number" step="0.1" value="0"><span class="suffix">%</span></div>
      </div>
      <div class="row" id="furyRow">
        <label>Fury Lv.10</label>
        <div class="inline">
          <input id="fury" type="checkbox">
          <span class="muted">Berserker only</span>
        </div>
      </div>
    </div>

    <!-- Progress -->
    <div class="bar"><div id="progressFill"></div></div>
    <div class="muted" id="progressText">Progress: —</div>

    <!-- Results -->
    <div class="boxrow">
      <label>Required ATK SPD</label>
      <div class="pct"><input id="requiredBox" type="number" readonly><span class="suffix">%</span></div>
    </div>
    <div class="boxrow">
      <label>Final ATK SPD</label>
      <input id="finalBox" type="number" readonly>
    </div>
  </div>

  <div class="card">
    <h2>DPS Inputs</h2>
    <div class="grid">
      <div class="row">
        <label>Weapon ATK (base)</label>
        <input id="atk" type="number" step="1" value="1000">
      </div>
      <div class="row">
        <label>ATK %</label>
        <div class="pct"><input id="atkPct" type="number" step="0.1" value="0"><span class="suffix">%</span></div>
      </div>
      <div class="row">
        <label>Racial %</label>
        <div class="pct"><input id="racialPct" type="number" step="0.1" value="0"><span class="suffix">%</span></div>
      </div>
      <div class="row">
        <label>Crit Chance</label>
        <div class="pct"><input id="crit" type="number" step="0.1" value="30"><span class="suffix">%</span></div>
      </div>
      <div class="row">
        <label>Crit DMG (extra)</label>
        <div class="pct"><input id="critDmg" type="number" step="1" value="100"><span class="suffix">%</span></div>
      </div>
      <div class="row">
        <label>Other DMG Multiplier</label>
        <input id="otherMult" type="number" step="0.01" value="1.00">
      </div>
    </div>
    <div class="result mono" id="dmgLine">Effective Hit Damage: —</div>
    <div class="result mono" id="dpsLine">DPS (uses Final ATK SPD above): —</div>
  </div>

  <div class="card footer">
    Tip: after publishing to GitHub Pages, open in Safari → Share → <b>Add to Home Screen</b> to use as an app.
  </div>

<script>
  const base = {
    "Original": {"Berserker":2.0, "Paladin":2.4, "Ranger":1.8, "Sorcerer":2.2},
    "Primal":   {"Berserker":2.0, "Paladin":2.4, "Ranger":1.8, "Sorcerer":2.2},
    "PVP/Boss": {"Berserker":2.2, "Paladin":2.5, "Ranger":2.0, "Sorcerer":2.3}
  };
  const TARGET_FINAL = 0.25;

  const els = (ids => ids.reduce((o,id)=> (o[id]=document.getElementById(id),o),{}))(
    ["cls","weap","char","col","guild","secret","equip","rune","quicken","fury",
     "progressFill","progressText","requiredBox","finalBox",
     "atk","atkPct","racialPct","crit","critDmg","otherMult","dmgLine","dpsLine"]
  );
  const furyRow = document.getElementById("furyRow");

  function clamp(x, min, max){ return Math.max(min, Math.min(max, x)); }
  function pctInput(id){ return (parseFloat(els[id].value || 0) / 100); }
  function pctSelect(id){ return (parseFloat(els[id].value || 0) / 100); }

  function recalc(){
    const cls = els.cls.value;
    const weap = els.weap.value;
    const baseSpd = base[weap][cls];

    if (cls === "Berserker") {
      furyRow.classList.remove("disabled");
    } else {
      furyRow.classList.add("disabled");
      els.fury.checked = false;
    }

    const char = pctSelect("char");
    const color = pctSelect("col");
    const guild = pctInput("guild");
    const secret = pctInput("secret");
    const equip = pctInput("equip");
    const rune = pctInput("rune");
    const quicken = pctInput("quicken");
    const furyFactor = (els.fury.checked && cls === "Berserker") ? 0.25 : 1.0;

    const totalBonuses = char + color + guild + secret + equip + rune;

    const denom = Math.max(baseSpd * (1 - quicken) * furyFactor, 1e-9);
    const requiredTotal = 1 - (TARGET_FINAL / denom);
    const remaining = Math.max(0, requiredTotal - totalBonuses);
    const progress = clamp(requiredTotal <= 0 ? 1 : totalBonuses / requiredTotal, 0, 1);

    let finalRaw = baseSpd * (1 - totalBonuses) * (1 - quicken) * furyFactor;
    const finalSpd = Math.max(finalRaw, TARGET_FINAL);

    els.progressFill.style.width = (progress * 100).toFixed(1) + '%';
    if(progress >= 1){ els.progressFill.style.background = "#4caf50"; }
    else if(progress >= 0.9){ els.progressFill.style.background = "#ffc107"; }
    else{ els.progressFill.style.background = "#2196f3"; }
    els.progressText.textContent = `Progress: ${(progress*100).toFixed(1)}% of required covered`;

    els.requiredBox.value = (remaining * 100).toFixed(2);
    els.finalBox.value = finalSpd.toFixed(3);

    const atk = parseFloat(els.atk.value || 0);
    const atkPct = pctInput("atkPct");
    const racial = pctInput("racialPct");
    const crit = clamp(pctInput("crit"),0,1);
    const critDmg = pctInput("critDmg");
    const other = parseFloat(els.otherMult.value || 1);

    const baseDamage = atk * (1+atkPct) * (1+racial) * other;
    const expectedCrit = (1-crit) + crit * (1 + critDmg);
    const effDamage = baseDamage * expectedCrit;
    const dps = effDamage / Math.max(finalSpd, 1e-9);

    els.dmgLine.textContent = `Effective Hit Damage: ${effDamage.toFixed(2)}`;
    els.dpsLine.textContent = `DPS: ${dps.toFixed(2)}`;
  }

  ["input","change"].forEach(evt => document.addEventListener(evt, e => {
    if (e.target.matches('input, select')) recalc();
  }));
  recalc();
</script>
</body>
</html>
